.. _simulationsetup:

Simulation setup
================

Population-based ancestry is only well-defined with reference to some
particular time.
For instance, suppose that my maternal grandmother belonged to Population A,
and my mother migrated into Population B.
I inherited some of my genome from these ancestors --  but which population did it come from?
The answer depends on a point in *time* -- in particular,
on whether we are interested in ancestry one or two generations ago.

Generally what's meant by 'ancestry' is 'where the ancestors were at some particular point in the past'.
By default, ``msprime`` and ``SLiM`` do not retain information about the ancestry of individuals at each point in the simulated history.
The rest of this page explains how to explicitly specify this.

``msprime`` simulations
-----------------------

Let's make this more concrete with an example.
Here's a ``msprime.Demography`` object describing an admixture event between two populations,
`SMALL` and `BIG`, that happened 20 time units ago.
These two populations split from a common ancestral population,
`ANC`, 600 time units ago.

.. note::
	Add in DemesDraw diagram.

.. code-block:: python

	demography = msprime.Demography()
	demography.add_population(name="SMALL", initial_size=200)
	demography.add_population(name="BIG", initial_size=500)
	demography.add_population(name="ADMIX", initial_size=200)
	demography.add_population(name="ANC", initial_size=500)
	demography.add_admixture(
	    time=20, derived="ADMIX", ancestral=["SMALL", "BIG"], proportions=[0.5, 0.5]
	)
	demography.add_population_split(
	    time=600, derived=["SMALL", "BIG"], ancestral="ANC"
	)

We'll simulate a 10kb region of two diploid individuals from the admixed population `ADMIX` like this:

.. code-block:: python

	ts = msprime.sim_ancestry(
	    samples={"SMALL": 0, "BIG": 0, "ADMIX" : 2},
	    demography=demography,
	    random_seed=1008,
	    sequence_length=10000,
	    recombination_rate=3e-8
	)

Have a look at this msprime tutorial if you need a refresher on this syntax.


By default, the tree sequences generated by msprime may not contain all of the ancestral nodes that are needed to extract information about local ancestry.

The `add-census` method is a special demographic event that we added into `msprime` to record a node on all lineages that are extant at a given time.
This is needed to simulate complete information about local ancestry.

You should add the census at a time when all of the relevant ancestral
populations are active, and at a time when there are no other coalescent nodes.
(We recommend setting it at a non-integer time to ensure no clashes with DTWF simulations).

For instance, in the code below, we specify a census event at time `599.5`.
Note that this is after the split of the populations (600 time units ago),
but before the admixture event.