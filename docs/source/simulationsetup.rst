.. _simulationsetup:

Simulation setup
================

As we discussed above, 'ancestry' only makes sense with reference to a particular time. Generally what's meant by 'ancestry' is 'where the ancestors were at some particular point in the past'.

`msprime` simulations
---------------------

Here's a `msprime` setup of a two-population admixture

.. code-block:: python

	demography = msprime.Demography()
	demography.add_population(name="SMALL", initial_size=200)
	demography.add_population(name="BIG", initial_size=500)
	demography.add_population(name="ADMIX", initial_size=200)
	demography.add_population(name="ANC", initial_size=500)
	demography.add_admixture(
	    time=20,
	    derived="ADMIX",
	    ancestral=["SMALL", "BIG"],
	    proportions=[0.5, 0.5]
	)
	demography.add_population_split(
	    time=600,
	    derived=["SMALL", "BIG"],
	    ancestral="ANC"
	)

which we'll simulate like this:

.. code-block:: python

	ts = msprime.sim_ancestry(
	    samples={"SMALL": 0, "BIG": 0, "ADMIX" : 2},
	    demography=demography,
	    random_seed=1008,
	    sequence_length=10000,
	    recombination_rate=3e-8
	)

By default, the tree sequences generated by msprime may not contain all of the ancestral nodes that are needed to extract information about local ancestry.

The `add-census` method is a special demographic event that we added into `msprime` to record a node on all lineages that are extant at a given time.
This is needed to simulate complete information about local ancestry.

You should add the census at a time when all of the relevant ancestral
populations are active, and at a time when there are no other coalescent nodes.
(We recommend setting it at a non-integer time to ensure no clashes with DTWF simulations).

For instance, in the code below, we specify a census event at time `599.5`.
Note that this is after the split of the populations (600 time units ago),
but before the admixture event.